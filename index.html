<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Lease vs Rent – Aladdin Fintech Experience</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

/* ============================= */
/* ===== ELITE FINTECH UI ====== */
/* ============================= */

:root{
--bg:#060d15;
--card:#0e1a27;
--text:#eaf2f9;
--accent:#4db3ff;
--muted:#94a8bd;
--green:#2ecc71;
--amber:#f1c40f;
--red:#ff4d4d;
}

body.light{
--bg:#f4f7fb;
--card:#ffffff;
--text:#0b1622;
--accent:#1f4e79;
--muted:#5c6c7a;
}

body{
margin:0;
padding:32px;
font-family:Inter,system-ui,Arial;
background:var(--bg);
color:var(--text);
transition:.35s;
scroll-behavior:smooth;
}

.container{
max-width:1400px;
margin:auto;
display:grid;
gap:28px;
}

/* ===== CARDS ===== */

.card,.chartCard{
background:var(--card);
padding:24px;
border-radius:18px;
box-shadow:0 18px 40px rgba(0,0,0,.35);
opacity:0;
transform:translateY(20px);
transition:all .6s ease;
}

.card.show,.chartCard.show{
opacity:1;
transform:translateY(0);
}

.card:hover,.chartCard:hover{
transform:translateY(-2px);
box-shadow:0 25px 55px rgba(0,0,0,.45);
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
gap:22px;
}

.field{display:flex;flex-direction:column;gap:6px;}

label{
font-size:12px;
color:var(--muted);
font-weight:600;
letter-spacing:.4px;
}

.micro{
font-size:11px;
color:var(--accent);
font-weight:700;
min-height:14px;
transition:.25s;
}

.focusGlow{
transform:scale(1.05);
}

input[type=text]{
padding:12px;
border-radius:10px;
border:none;
background:#0a1826;
color:var(--text);
font-weight:700;
}

body.light input[type=text]{background:#eef3f8;}

input[type=range]{width:100%;cursor:pointer;}

.toggle{
position:fixed;
top:16px;
right:16px;
background:var(--accent);
color:#fff;
padding:10px 16px;
border-radius:30px;
cursor:pointer;
font-weight:700;
z-index:99;
}

/* ===== GAUGE ===== */

.gaugeWrap{display:flex;justify-content:center;margin-top:8px;}

.gauge{
width:200px;
height:200px;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
transition:.5s;
}

.gaugeInner{
width:155px;
height:155px;
border-radius:50%;
background:var(--bg);
display:flex;
align-items:center;
justify-content:center;
font-size:36px;
font-weight:900;
}

.savingsBox{
margin-top:18px;
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:16px;
}

.metricValue{
font-size:26px;
font-weight:900;
}

</style>
</head>

<body>

<div class="toggle" onclick="toggleTheme()"> Light /  Dark</div>

<div class="container">

<!-- INPUT PANEL -->
<div class="card">
<div class="grid">

<div class="field">
<label>Lease Amount</label>
<input id="leaseAmount" class="currency">
<input type="range" id="leaseAmountRange" min="100000" max="5000000" step="50000">
</div>

<div class="field">
<label>Loan Amount</label>
<input id="loanAmount" class="currency">
<input type="range" id="loanAmountRange" min="0" max="3000000" step="50000">
</div>

<div class="field">
<label>Loan Interest %</label>
<input id="loanRate" class="percent">
<div id="emiLabel" class="micro"></div>
<input type="range" id="loanRateRange" min="1" max="20" step="0.1">
</div>

<div class="field">
<label>Opportunity Cost %</label>
<input id="oppRate" class="percent">
<div id="oppLabel" class="micro"></div>
<input type="range" id="oppRateRange" min="1" max="20" step="0.1">
</div>

<div class="field">
<label>Risk Premium %</label>
<input id="riskPremium" class="percent">
<div id="riskLabel" class="micro"></div>
<input type="range" id="riskPremiumRange" min="0" max="20" step="0.1">
</div>

<div class="field">
<label>Market Rent</label>
<input id="marketRent" class="currency">
<input type="range" id="marketRentRange" min="5000" max="100000" step="1000">
</div>

<div class="field">
<label>Maintenance</label>
<input id="maintenance" class="currency">
<input type="range" id="maintenanceRange" min="0" max="20000" step="500">
</div>

<div class="field">
<label>Notional Rent Increment %</label>
<input id="rentIncrement" class="percent">
</div>

<input id="loanTenure" placeholder="Loan Tenure Months">
<input id="leaseTenure" placeholder="Lease Tenure Months">
<input id="withholding" class="percent" placeholder="Withholding %">
<input id="refundDelay" placeholder="Refund Delay Months">

</div>
</div>

<!-- GAUGE PANEL -->
<div class="card">
<div class="gaugeWrap">
<div id="gauge" class="gauge">
<div id="dial" class="gaugeInner">0</div>
</div>
</div>

<div class="savingsBox">
<div><div>Monthly Savings</div><div id="mSave" class="metricValue"></div></div>
<div><div>Yearly Savings</div><div id="ySave" class="metricValue"></div></div>
<div><div>Lease Term Savings</div><div id="tSave" class="metricValue"></div></div>
</div>
</div>

<div class="chartCard"><canvas id="waterfallChart"></canvas></div>
<div class="chartCard"><canvas id="forwardRentChart"></canvas></div>
<div class="chartCard"><canvas id="breakEvenChart"></canvas></div>

</div>

<script>

/* ================= THEME ================= */

function toggleTheme(){
document.body.classList.toggle("light");
}

/* ================= SCROLL REVEAL ================= */

const observer=new IntersectionObserver(entries=>{
entries.forEach(e=>{
if(e.isIntersecting) e.target.classList.add("show");
});
},{threshold:.1});

document.querySelectorAll(".card,.chartCard").forEach(el=>observer.observe(el));

/* ================= HELPERS ================= */

const $=id=>document.getElementById(id);

function cleanNumber(v){
return parseFloat((v||"").replace(/[,%\s,]/g,""))||0;
}
function num(id){return cleanNumber($(id).value);}
function INR(n){return " "+Math.round(n||0).toLocaleString("en-IN");}

function formatINR(n){return " "+Number(n).toLocaleString("en-IN");}
function formatPercent(n){return Number(n).toLocaleString("en-IN",{maximumFractionDigits:2})+"%";}

function attachFormatter(selector,formatter){
document.querySelectorAll(selector).forEach(el=>{
let timer;
el.addEventListener("input",()=>{
clearTimeout(timer);
timer=setTimeout(()=>{
let raw=cleanNumber(el.value);
if(raw) el.value=formatter(raw);
calculate();
},250);
});
});
}
attachFormatter(".currency",formatINR);
attachFormatter(".percent",formatPercent);

/* ================= RANGE SYNC ================= */

["leaseAmount","loanAmount","loanRate","oppRate","riskPremium","marketRent","maintenance"]
.forEach(id=>{
let input=$(id);
let range=$(id+"Range");
if(!range) return;
range.addEventListener("input",()=>{input.value=range.value;calculate();});
input.addEventListener("input",()=>{range.value=cleanNumber(input.value);});
});

/* ================= ENGINE (UNCHANGED LOGIC) ================= */

let waterfallChart,forwardRentChart,breakEvenChart;

function emi(P,r,n){
if(r===0)return P/n;
return P*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1);
}

function calculate(){

document.querySelectorAll(".micro").forEach(m=>{
m.classList.add("focusGlow");
setTimeout(()=>m.classList.remove("focusGlow"),250);
});

const LEASE_AMOUNT=num("leaseAmount");
const LOAN_AMOUNT=num("loanAmount");
const OWN_FUNDS=Math.max(0,LEASE_AMOUNT-LOAN_AMOUNT);

const LOAN_INTEREST_RATE=(num("loanRate")/100)/12;
const LOAN_TENURE=num("loanTenure");
const LEASE_TENURE=num("leaseTenure");

const WITHHOLDING=num("withholding")/100;
const REFUND_DELAY=num("refundDelay");

const MAINTENANCE=num("maintenance");
const MARKET_RENT=num("marketRent");

const OPP_RATE=(num("oppRate")/100)/12;
const RISK_PREMIUM=num("riskPremium")/100;
const RENT_INCREMENT=num("rentIncrement")/100;

const EMI=emi(LOAN_AMOUNT,LOAN_INTEREST_RATE,LOAN_TENURE);
const totalInterest=EMI*LOAN_TENURE-LOAN_AMOUNT;

const monthlyLeaseCost=EMI+MAINTENANCE;

const refund=LEASE_AMOUNT*(1-WITHHOLDING);
const withholdingLoss=LEASE_AMOUNT*WITHHOLDING;

const ownOpp=OWN_FUNDS*(Math.pow(1+OPP_RATE,LEASE_TENURE)-1);

let emiOpp=0;

for(let m=1;m<=LEASE_TENURE;m++){
const yearIndex=Math.floor((m-1)/12);
const adjustedRent=MARKET_RENT*Math.pow(1+RENT_INCREMENT,yearIndex);
const extra=monthlyLeaseCost-adjustedRent;
if(extra>0){
emiOpp+=extra*(Math.pow(1+OPP_RATE,LEASE_TENURE-m+1)-1);
}
}

const delayCost=refund*OPP_RATE*REFUND_DELAY;

const capitalLoss=totalInterest+withholdingLoss;

const totalEconomic=capitalLoss+ownOpp+emiOpp+delayCost;

const riskRent=(totalEconomic/LEASE_TENURE)*(1+RISK_PREMIUM);

const monthlySavings=MARKET_RENT-riskRent;
const yearlySavings=monthlySavings*12;
const termSavings=monthlySavings*LEASE_TENURE;

let score=MARKET_RENT>0?(monthlySavings/MARKET_RENT)*100:0;
score=Math.max(0,Math.min(100,score));

let color="var(--amber)";
if(score<5) color="var(--red)";
if(score>20) color="var(--green)";

$("gauge").style.background=
`conic-gradient(${color} ${score*3.6}deg,#243648 ${score*3.6}deg)`;

$("dial").innerText=Math.round(score);

$("emiLabel").innerText="EMI: "+INR(EMI);
$("oppLabel").innerText="Opp Cost Impact: "+INR(ownOpp);
$("riskLabel").innerText="Risk Rent: "+INR(riskRent);

$("mSave").innerText=INR(monthlySavings);
$("ySave").innerText=INR(yearlySavings);
$("tSave").innerText=INR(termSavings);

/* ===== WATERFALL UPDATE ===== */

if(!waterfallChart){
waterfallChart=new Chart($("waterfallChart"),{
type:"bar",
data:{labels:["Interest","Opp Cost","EMI Opp","Delay","Withholding"],
datasets:[{data:[0,0,0,0,0]}]},
options:{animation:{duration:700,easing:"easeOutQuart"}}
});
}

waterfallChart.data.datasets[0].data=[totalInterest,ownOpp,emiOpp,delayCost,withholdingLoss];
waterfallChart.update();

/* ===== FORWARD RENT UPDATE ===== */

let rentSeries=[],labels=[];
for(let m=1;m<=LEASE_TENURE;m++){
let yearIndex=Math.floor((m-1)/12);
rentSeries.push(MARKET_RENT*Math.pow(1+RENT_INCREMENT,yearIndex));
labels.push(m);
}

if(!forwardRentChart){
forwardRentChart=new Chart($("forwardRentChart"),{
type:"line",
data:{labels:labels,datasets:[{label:"Forward Rent Curve",data:rentSeries}]},
options:{animation:{duration:800}}
});
}else{
forwardRentChart.data.labels=labels;
forwardRentChart.data.datasets[0].data=rentSeries;
forwardRentChart.update();
}

/* ===== BREAK EVEN UPDATE ===== */

let riskAxis=[],savingsAxis=[];
for(let r=0;r<=20;r+=1){
let simulatedRiskRent=riskRent*(1+r/100);
riskAxis.push(r+"%");
savingsAxis.push(MARKET_RENT-simulatedRiskRent);
}

if(!breakEvenChart){
breakEvenChart=new Chart($("breakEvenChart"),{
type:"line",
data:{labels:riskAxis,datasets:[{label:"Break-even Curve",data:savingsAxis}]},
options:{animation:{duration:800}}
});
}else{
breakEvenChart.data.labels=riskAxis;
breakEvenChart.data.datasets[0].data=savingsAxis;
breakEvenChart.update();
}

}

document.querySelectorAll("input").forEach(el=>{
el.addEventListener("input",calculate);
});

</script>
</body>
</html>