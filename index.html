<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Lease vs Rent – Hedge Fund Grade</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

/* ===== HEDGE FUND DESIGN SYSTEM ===== */

*{box-sizing:border-box;}

:root{
--bg:#f4f7fb;
--card:rgba(255,255,255,.78);
--text:#0b1622;
--muted:#6c7a89;
--accent:#1f4e79;
--shadow:0 30px 60px rgba(0,0,0,.08);
}

body.dark{
--bg:#0b1622;
--card:rgba(18,30,44,.7);
--text:#e8f1fb;
--muted:#8ea2b5;
--accent:#00c3ff;
--shadow:0 30px 60px rgba(0,0,0,.35);
}

body{
margin:0;
padding:28px;
font-family:Inter,Arial;
background:var(--bg);
color:var(--text);
transition:.3s;
}

.container{max-width:1200px;margin:auto;}

.card{
background:var(--card);
backdrop-filter:blur(18px);
padding:24px;
margin-bottom:24px;
border-radius:18px;
box-shadow:var(--shadow);
}

.hero{text-align:center;margin-bottom:24px;}
.hero h1{margin:0;font-size:30px;}
.hero p{color:var(--muted);}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:14px;
}

input{
padding:12px;
border-radius:10px;
border:1px solid rgba(0,0,0,.08);
background:transparent;
color:var(--text);
font-size:14px;
width:100%;
}

button{
background:var(--accent);
color:#fff;
border:none;
padding:10px 14px;
border-radius:10px;
font-weight:600;
cursor:pointer;
margin-top:10px;
}

.metricValue{font-size:24px;font-weight:700;margin-top:4px;}
.metricLabel{font-size:13px;color:var(--muted);margin-top:12px;}

.confidenceBar{
height:12px;
border-radius:20px;
background:#ddd;
overflow:hidden;
margin-top:8px;
}

.confidenceFill{
height:100%;
width:0%;
background:linear-gradient(90deg,#ff4d4d,#f1c40f,#2ecc71);
transition:width .8s ease;
}

.chartStack{display:flex;flex-direction:column;gap:24px;}

.chartCard{
background:var(--card);
padding:20px;
border-radius:18px;
box-shadow:var(--shadow);
min-height:320px;
}

canvas{max-width:100%;}

.toggle{
position:fixed;
top:16px;
right:16px;
background:var(--accent);
color:#fff;
padding:6px 12px;
border-radius:20px;
cursor:pointer;
font-size:12px;
}

</style>
</head>

<body>

<div class="toggle" onclick="toggleTheme()"> Theme</div>

<div class="container">

<div class="hero">
<h1>Lease vs Rent – Hedge Fund Analytics</h1>
<p>Quant-grade capital efficiency modelling with sensitivity analytics.</p>
</div>

<div class="card">
<div class="grid">
<input id="leaseAmount" class="currency" placeholder="Lease Amount">
<input id="loanAmount" class="currency" placeholder="Loan Amount">
<input id="loanRate" class="percent" placeholder="Loan Interest %">
<input id="loanTenure" placeholder="Loan Tenure Months">
<input id="leaseTenure" placeholder="Lease Tenure Months">
<input id="withholding" class="percent" placeholder="Withholding %">
<input id="refundDelay" placeholder="Refund Delay Months">
<input id="maintenance" class="currency" placeholder="Monthly Maintenance">
<input id="marketRent" class="currency" placeholder="Market Rent">
<input id="oppRate" class="percent" placeholder="Opportunity Cost %">
<input id="riskPremium" class="percent" placeholder="Risk Premium %">
</div>

<button onclick="calculate()">Run Analysis</button>
</div>

<div class="card">
<div id="results"></div>

<div class="metricLabel">Decision Confidence</div>
<div class="confidenceBar"><div id="confidenceFill" class="confidenceFill"></div></div>
</div>

<div class="chartStack">
<div class="chartCard"><canvas id="comparisonChart"></canvas></div>
<div class="chartCard"><canvas id="scenarioChart"></canvas></div>
<div class="chartCard"><canvas id="radarChart"></canvas></div>
<div class="chartCard"><canvas id="sensitivityChart"></canvas></div>
<div class="chartCard"><canvas id="compositionChart"></canvas></div>
</div>

</div>

<script>

/* ===== THEME ===== */
function toggleTheme(){document.body.classList.toggle("dark");}

const $=id=>document.getElementById(id);

/* ===== DECIMAL-FLEXIBLE FORMAT ENGINE ===== */

function cleanNumber(v){
return parseFloat((v||"").replace(/[,%\s,]/g,""))||0;
}
function num(id){return cleanNumber($(id).value);}

function formatINR(n){
return " "+Number(n).toLocaleString("en-IN",{maximumFractionDigits:2});
}
function formatPercent(n){
return Number(n).toString()+"%";
}

function smartFormat(el,formatter){
let caret=el.selectionStart;
let raw=cleanNumber(el.value);
if(!el.value){return;}
let before=el.value.length;
el.value=formatter(raw);
let after=el.value.length;
el.setSelectionRange(caret+(after-before),caret+(after-before));
}

document.querySelectorAll(".currency").forEach(el=>{
el.addEventListener("blur",()=>smartFormat(el,formatINR));
});
document.querySelectorAll(".percent").forEach(el=>{
el.addEventListener("blur",()=>smartFormat(el,formatPercent));
});

/* ===== ORIGINAL FINANCIAL ENGINE (UNCHANGED) ===== */

let comparisonChart,scenarioChart,compositionChart,radarChart,sensitivityChart;

function INR(n){return " "+Math.round(n||0).toLocaleString("en-IN");}

function emi(P,r,n){
if(r===0)return P/n;
return P*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1);
}
function futureValue(pmt,rate,n){
if(rate===0)return pmt*n;
return pmt*((Math.pow(1+rate,n)-1)/rate);
}

function coreCalc(riskPremiumOverride){

const LEASE_AMOUNT=num("leaseAmount");
const LOAN_AMOUNT=num("loanAmount");
const OWN_FUNDS=Math.max(0,LEASE_AMOUNT-LOAN_AMOUNT);

const LOAN_INTEREST_RATE=(num("loanRate")/100)/12;
const LOAN_TENURE=num("loanTenure");
const LEASE_TENURE=num("leaseTenure");

const WITHHOLDING=num("withholding")/100;
const REFUND_DELAY=num("refundDelay");

const MAINTENANCE=num("maintenance");
const MARKET_RENT=num("marketRent");

const OPP_RATE=(num("oppRate")/100)/12;
const RISK_PREMIUM=riskPremiumOverride ?? (num("riskPremium")/100);

const EMI=emi(LOAN_AMOUNT,LOAN_INTEREST_RATE,LOAN_TENURE);
const totalInterest=EMI*LOAN_TENURE-LOAN_AMOUNT;

const monthlyLeaseCost=EMI+MAINTENANCE;
const monthlyExtra=monthlyLeaseCost-MARKET_RENT;

const refund=LEASE_AMOUNT*(1-WITHHOLDING);
const withholdingLoss=LEASE_AMOUNT*WITHHOLDING;

const ownOpp=OWN_FUNDS*(Math.pow(1+OPP_RATE,LEASE_TENURE)-1);

let emiOpp=0;
if(monthlyExtra>0){
emiOpp=futureValue(monthlyExtra,OPP_RATE,LEASE_TENURE)-(monthlyExtra*LEASE_TENURE);
}

const delayCost=refund*OPP_RATE*REFUND_DELAY;

const capitalLoss=totalInterest+withholdingLoss;

const totalEconomic=
capitalLoss+
ownOpp+
emiOpp+
delayCost;

const riskRent=(totalEconomic/LEASE_TENURE)*(1+RISK_PREMIUM);

const monthlySavings=MARKET_RENT-riskRent;
let score=MARKET_RENT>0?(monthlySavings/MARKET_RENT)*100:0;
score=Math.max(0,Math.min(100,score));

return {EMI,monthlyLeaseCost,riskRent,monthlySavings,score,totalInterest,ownOpp,emiOpp,delayCost,withholdingLoss};
}

function calculate(){

const MARKET_RENT=num("marketRent");
const LEASE_TENURE=num("leaseTenure");

const base=coreCalc();

$("confidenceFill").style.width=base.score+"%";

$("results").innerHTML=`
<div class="metricLabel">Monthly EMI</div>
<div class="metricValue">${INR(base.EMI)}</div>

<div class="metricLabel">Risk Adjusted Rent</div>
<div>${INR(base.riskRent)}</div>

<div class="metricLabel">Monthly Savings</div>
<div class="metricValue">${INR(base.monthlySavings)}</div>
`;

/* ===== SENSITIVITY SURFACE ===== */

let labels=[];
let savings=[];
for(let i=0.02;i<=0.12;i+=0.01){
let r=coreCalc(i);
labels.push((i*100).toFixed(1)+"%");
savings.push(r.monthlySavings);
}

if(sensitivityChart)sensitivityChart.destroy();
sensitivityChart=new Chart($("sensitivityChart"),{
type:"line",
data:{labels,datasets:[{label:"Savings vs Risk Premium",data:savings}]}
});

/* ===== OTHER CHARTS ===== */

if(comparisonChart)comparisonChart.destroy();
comparisonChart=new Chart($("comparisonChart"),{
type:"bar",
data:{labels:["Market Rent","Risk Rent","Lease Monthly Cost"],
datasets:[{data:[MARKET_RENT,base.riskRent,base.monthlyLeaseCost]}]}
});

if(radarChart)radarChart.destroy();
radarChart=new Chart($("radarChart"),{
type:"radar",
data:{
labels:["Savings Strength","Risk Load","Capital Drag","Efficiency"],
datasets:[{data:[base.score,(base.riskRent/MARKET_RENT)*100,30,base.score]}]
}
});

if(compositionChart)compositionChart.destroy();
compositionChart=new Chart($("compositionChart"),{
type:"doughnut",
data:{labels:["Interest","OwnOpp","EmiOpp","Delay","Withholding"],
datasets:[{data:[base.totalInterest,base.ownOpp,base.emiOpp,base.delayCost,base.withholdingLoss]}]}
});

}

</script>
</body>
</html>